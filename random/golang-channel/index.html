<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Goroutine 與 Channel 的共舞 | Shawn Hsu</title>
<meta name="description" content="在不同的 process 之間進行溝通的方式有很多種，本篇文章將會介紹一些常見的溝通方式以及 golang 推崇的 channel 機制">


  <meta name="author" content="Shawn Hsu">
  
  <meta property="article:author" content="Shawn Hsu">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Shawn Hsu">
<meta property="og:title" content="Goroutine 與 Channel 的共舞">
<meta property="og:url" content="https://ambersuncreates.com/random/golang-channel/">


  <meta property="og:description" content="在不同的 process 之間進行溝通的方式有很多種，本篇文章將會介紹一些常見的溝通方式以及 golang 推崇的 channel 機制">


<meta property="og:image" content="/assets/img/og/golang-channel.png">




  <meta property="article:published_time" content="2023-03-25T00:00:00+08:00">



  <meta property="article:modified_time" content="2025-12-17T21:45:59+08:00">



  

  


<link rel="canonical" href="https://ambersuncreates.com/random/golang-channel/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Shawn Hsu",
      "url": "https://ambersuncreates.com/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Shawn Hsu Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3411784157543420"
     crossorigin="anonymous"></script>

<!-- google ads -->
<script async src="https://fundingchoicesmessages.google.com/i/pub-3411784157543420?ers=1" nonce="DTHVC27nOex6L5olJXhYMg"></script><script nonce="DTHVC27nOex6L5olJXhYMg">(function() {function signalGooglefcPresent() {if (!window.frames['googlefcPresent']) {if (document.body) {const iframe = document.createElement('iframe'); iframe.style = 'width: 0; height: 0; border: none; z-index: -1000; left: -1000px; top: -1000px;'; iframe.style.display = 'none'; iframe.name = 'googlefcPresent'; document.body.appendChild(iframe);} else {setTimeout(signalGooglefcPresent, 0);}}}signalGooglefcPresent();})();</script>
<script>(function(){'use strict';function aa(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}var ba="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};
  function ca(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");}var da=ca(this);function k(a,b){if(b)a:{var c=da;a=a.split(".");for(var d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))break a;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&ba(c,a,{configurable:!0,writable:!0,value:b})}}
  function ea(a){return a.raw=a}function m(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];if(b)return b.call(a);if("number"==typeof a.length)return{next:aa(a)};throw Error(String(a)+" is not an iterable or ArrayLike");}function fa(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c}var ha="function"==typeof Object.create?Object.create:function(a){function b(){}b.prototype=a;return new b},n;
  if("function"==typeof Object.setPrototypeOf)n=Object.setPrototypeOf;else{var q;a:{var ia={a:!0},ja={};try{ja.__proto__=ia;q=ja.a;break a}catch(a){}q=!1}n=q?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var ka=n;
  function r(a,b){a.prototype=ha(b.prototype);a.prototype.constructor=a;if(ka)ka(a,b);else for(var c in b)if("prototype"!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.A=b.prototype}function la(){for(var a=Number(this),b=[],c=a;c<arguments.length;c++)b[c-a]=arguments[c];return b}k("Number.MAX_SAFE_INTEGER",function(){return 9007199254740991});
  k("Number.isFinite",function(a){return a?a:function(b){return"number"!==typeof b?!1:!isNaN(b)&&Infinity!==b&&-Infinity!==b}});k("Number.isInteger",function(a){return a?a:function(b){return Number.isFinite(b)?b===Math.floor(b):!1}});k("Number.isSafeInteger",function(a){return a?a:function(b){return Number.isInteger(b)&&Math.abs(b)<=Number.MAX_SAFE_INTEGER}});
  k("Math.trunc",function(a){return a?a:function(b){b=Number(b);if(isNaN(b)||Infinity===b||-Infinity===b||0===b)return b;var c=Math.floor(Math.abs(b));return 0>b?-c:c}});k("Object.is",function(a){return a?a:function(b,c){return b===c?0!==b||1/b===1/c:b!==b&&c!==c}});k("Array.prototype.includes",function(a){return a?a:function(b,c){var d=this;d instanceof String&&(d=String(d));var e=d.length;c=c||0;for(0>c&&(c=Math.max(c+e,0));c<e;c++){var f=d[c];if(f===b||Object.is(f,b))return!0}return!1}});
  k("String.prototype.includes",function(a){return a?a:function(b,c){if(null==this)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return-1!==this.indexOf(b,c||0)}});/*
  
   Copyright The Closure Library Authors.
   SPDX-License-Identifier: Apache-2.0
  */
  var t=this||self;function v(a){return a};var w,x;a:{for(var ma=["CLOSURE_FLAGS"],y=t,z=0;z<ma.length;z++)if(y=y[ma[z]],null==y){x=null;break a}x=y}var na=x&&x[610401301];w=null!=na?na:!1;var A,oa=t.navigator;A=oa?oa.userAgentData||null:null;function B(a){return w?A?A.brands.some(function(b){return(b=b.brand)&&-1!=b.indexOf(a)}):!1:!1}function C(a){var b;a:{if(b=t.navigator)if(b=b.userAgent)break a;b=""}return-1!=b.indexOf(a)};function D(){return w?!!A&&0<A.brands.length:!1}function E(){return D()?B("Chromium"):(C("Chrome")||C("CriOS"))&&!(D()?0:C("Edge"))||C("Silk")};var pa=D()?!1:C("Trident")||C("MSIE");!C("Android")||E();E();C("Safari")&&(E()||(D()?0:C("Coast"))||(D()?0:C("Opera"))||(D()?0:C("Edge"))||(D()?B("Microsoft Edge"):C("Edg/"))||D()&&B("Opera"));var qa={},F=null;var ra="undefined"!==typeof Uint8Array,sa=!pa&&"function"===typeof btoa;function G(){return"function"===typeof BigInt};var H=0,I=0;function ta(a){var b=0>a;a=Math.abs(a);var c=a>>>0;a=Math.floor((a-c)/4294967296);b&&(c=m(ua(c,a)),b=c.next().value,a=c.next().value,c=b);H=c>>>0;I=a>>>0}function va(a,b){b>>>=0;a>>>=0;if(2097151>=b)var c=""+(4294967296*b+a);else G()?c=""+(BigInt(b)<<BigInt(32)|BigInt(a)):(c=(a>>>24|b<<8)&16777215,b=b>>16&65535,a=(a&16777215)+6777216*c+6710656*b,c+=8147497*b,b*=2,1E7<=a&&(c+=Math.floor(a/1E7),a%=1E7),1E7<=c&&(b+=Math.floor(c/1E7),c%=1E7),c=b+wa(c)+wa(a));return c}
  function wa(a){a=String(a);return"0000000".slice(a.length)+a}function ua(a,b){b=~b;a?a=~a+1:b+=1;return[a,b]};var J;J="function"===typeof Symbol&&"symbol"===typeof Symbol()?Symbol():void 0;var xa=J?function(a,b){a[J]|=b}:function(a,b){void 0!==a.g?a.g|=b:Object.defineProperties(a,{g:{value:b,configurable:!0,writable:!0,enumerable:!1}})},K=J?function(a){return a[J]|0}:function(a){return a.g|0},L=J?function(a){return a[J]}:function(a){return a.g},M=J?function(a,b){a[J]=b;return a}:function(a,b){void 0!==a.g?a.g=b:Object.defineProperties(a,{g:{value:b,configurable:!0,writable:!0,enumerable:!1}});return a};function ya(a,b){M(b,(a|0)&-14591)}function za(a,b){M(b,(a|34)&-14557)}
  function Aa(a){a=a>>14&1023;return 0===a?536870912:a};var N={},Ba={};function Ca(a){return!(!a||"object"!==typeof a||a.g!==Ba)}function Da(a){return null!==a&&"object"===typeof a&&!Array.isArray(a)&&a.constructor===Object}function P(a,b,c){if(!Array.isArray(a)||a.length)return!1;var d=K(a);if(d&1)return!0;if(!(b&&(Array.isArray(b)?b.includes(c):b.has(c))))return!1;M(a,d|1);return!0}Object.freeze(new function(){});Object.freeze(new function(){});var Ea=/^-?([1-9][0-9]*|0)(\.[0-9]+)?$/;var Q;function Fa(a,b){Q=b;a=new a(b);Q=void 0;return a}
  function R(a,b,c){null==a&&(a=Q);Q=void 0;if(null==a){var d=96;c?(a=[c],d|=512):a=[];b&&(d=d&-16760833|(b&1023)<<14)}else{if(!Array.isArray(a))throw Error();d=K(a);if(d&64)return a;d|=64;if(c&&(d|=512,c!==a[0]))throw Error();a:{c=a;var e=c.length;if(e){var f=e-1;if(Da(c[f])){d|=256;b=f-(+!!(d&512)-1);if(1024<=b)throw Error();d=d&-16760833|(b&1023)<<14;break a}}if(b){b=Math.max(b,e-(+!!(d&512)-1));if(1024<b)throw Error();d=d&-16760833|(b&1023)<<14}}}M(a,d);return a};function Ga(a){switch(typeof a){case "number":return isFinite(a)?a:String(a);case "boolean":return a?1:0;case "object":if(a)if(Array.isArray(a)){if(P(a,void 0,0))return}else if(ra&&null!=a&&a instanceof Uint8Array){if(sa){for(var b="",c=0,d=a.length-10240;c<d;)b+=String.fromCharCode.apply(null,a.subarray(c,c+=10240));b+=String.fromCharCode.apply(null,c?a.subarray(c):a);a=btoa(b)}else{void 0===b&&(b=0);if(!F){F={};c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split("");d=["+/=",
  "+/","-_=","-_.","-_"];for(var e=0;5>e;e++){var f=c.concat(d[e].split(""));qa[e]=f;for(var g=0;g<f.length;g++){var h=f[g];void 0===F[h]&&(F[h]=g)}}}b=qa[b];c=Array(Math.floor(a.length/3));d=b[64]||"";for(e=f=0;f<a.length-2;f+=3){var l=a[f],p=a[f+1];h=a[f+2];g=b[l>>2];l=b[(l&3)<<4|p>>4];p=b[(p&15)<<2|h>>6];h=b[h&63];c[e++]=g+l+p+h}g=0;h=d;switch(a.length-f){case 2:g=a[f+1],h=b[(g&15)<<2]||d;case 1:a=a[f],c[e]=b[a>>2]+b[(a&3)<<4|g>>4]+h+d}a=c.join("")}return a}}return a};function Ha(a,b,c){a=Array.prototype.slice.call(a);var d=a.length,e=b&256?a[d-1]:void 0;d+=e?-1:0;for(b=b&512?1:0;b<d;b++)a[b]=c(a[b]);if(e){b=a[b]={};for(var f in e)Object.prototype.hasOwnProperty.call(e,f)&&(b[f]=c(e[f]))}return a}function Ia(a,b,c,d,e){if(null!=a){if(Array.isArray(a))a=P(a,void 0,0)?void 0:e&&K(a)&2?a:Ja(a,b,c,void 0!==d,e);else if(Da(a)){var f={},g;for(g in a)Object.prototype.hasOwnProperty.call(a,g)&&(f[g]=Ia(a[g],b,c,d,e));a=f}else a=b(a,d);return a}}
  function Ja(a,b,c,d,e){var f=d||c?K(a):0;d=d?!!(f&32):void 0;a=Array.prototype.slice.call(a);for(var g=0;g<a.length;g++)a[g]=Ia(a[g],b,c,d,e);c&&c(f,a);return a}function Ka(a){return a.s===N?a.toJSON():Ga(a)};function La(a,b,c){c=void 0===c?za:c;if(null!=a){if(ra&&a instanceof Uint8Array)return b?a:new Uint8Array(a);if(Array.isArray(a)){var d=K(a);if(d&2)return a;b&&(b=0===d||!!(d&32)&&!(d&64||!(d&16)));return b?M(a,(d|34)&-12293):Ja(a,La,d&4?za:c,!0,!0)}a.s===N&&(c=a.h,d=L(c),a=d&2?a:Fa(a.constructor,Ma(c,d,!0)));return a}}function Ma(a,b,c){var d=c||b&2?za:ya,e=!!(b&32);a=Ha(a,b,function(f){return La(f,e,d)});xa(a,32|(c?2:0));return a};function Na(a,b){a=a.h;return Oa(a,L(a),b)}function Oa(a,b,c,d){if(-1===c)return null;if(c>=Aa(b)){if(b&256)return a[a.length-1][c]}else{var e=a.length;if(d&&b&256&&(d=a[e-1][c],null!=d))return d;b=c+(+!!(b&512)-1);if(b<e)return a[b]}}function Pa(a,b,c,d,e){var f=Aa(b);if(c>=f||e){var g=b;if(b&256)e=a[a.length-1];else{if(null==d)return;e=a[f+(+!!(b&512)-1)]={};g|=256}e[c]=d;c<f&&(a[c+(+!!(b&512)-1)]=void 0);g!==b&&M(a,g)}else a[c+(+!!(b&512)-1)]=d,b&256&&(a=a[a.length-1],c in a&&delete a[c])}
  function Qa(a,b){var c=Ra;var d=void 0===d?!1:d;var e=a.h;var f=L(e),g=Oa(e,f,b,d);if(null!=g&&"object"===typeof g&&g.s===N)c=g;else if(Array.isArray(g)){var h=K(g),l=h;0===l&&(l|=f&32);l|=f&2;l!==h&&M(g,l);c=new c(g)}else c=void 0;c!==g&&null!=c&&Pa(e,f,b,c,d);e=c;if(null==e)return e;a=a.h;f=L(a);f&2||(g=e,c=g.h,h=L(c),g=h&2?Fa(g.constructor,Ma(c,h,!1)):g,g!==e&&(e=g,Pa(a,f,b,e,d)));return e}function Sa(a,b){a=Na(a,b);return null==a||"string"===typeof a?a:void 0}
  function Ta(a,b){var c=void 0===c?0:c;a=Na(a,b);if(null!=a)if(b=typeof a,"number"===b?Number.isFinite(a):"string"!==b?0:Ea.test(a))if("number"===typeof a){if(a=Math.trunc(a),!Number.isSafeInteger(a)){ta(a);b=H;var d=I;if(a=d&2147483648)b=~b+1>>>0,d=~d>>>0,0==b&&(d=d+1>>>0);b=4294967296*d+(b>>>0);a=a?-b:b}}else if(b=Math.trunc(Number(a)),Number.isSafeInteger(b))a=String(b);else{if(b=a.indexOf("."),-1!==b&&(a=a.substring(0,b)),!("-"===a[0]?20>a.length||20===a.length&&-922337<Number(a.substring(0,7)):
  19>a.length||19===a.length&&922337>Number(a.substring(0,6)))){if(16>a.length)ta(Number(a));else if(G())a=BigInt(a),H=Number(a&BigInt(4294967295))>>>0,I=Number(a>>BigInt(32)&BigInt(4294967295));else{b=+("-"===a[0]);I=H=0;d=a.length;for(var e=b,f=(d-b)%6+b;f<=d;e=f,f+=6)e=Number(a.slice(e,f)),I*=1E6,H=1E6*H+e,4294967296<=H&&(I+=Math.trunc(H/4294967296),I>>>=0,H>>>=0);b&&(b=m(ua(H,I)),a=b.next().value,b=b.next().value,H=a,I=b)}a=H;b=I;b&2147483648?G()?a=""+(BigInt(b|0)<<BigInt(32)|BigInt(a>>>0)):(b=
  m(ua(a,b)),a=b.next().value,b=b.next().value,a="-"+va(a,b)):a=va(a,b)}}else a=void 0;return null!=a?a:c}function S(a,b){a=Sa(a,b);return null!=a?a:""};function T(a,b,c){this.h=R(a,b,c)}T.prototype.toJSON=function(){return Ua(this,Ja(this.h,Ka,void 0,void 0,!1),!0)};T.prototype.s=N;T.prototype.toString=function(){return Ua(this,this.h,!1).toString()};
  function Ua(a,b,c){var d=a.constructor.v,e=L(c?a.h:b);a=b.length;if(!a)return b;var f;if(Da(c=b[a-1])){a:{var g=c;var h={},l=!1,p;for(p in g)if(Object.prototype.hasOwnProperty.call(g,p)){var u=g[p];if(Array.isArray(u)){var jb=u;if(P(u,d,+p)||Ca(u)&&0===u.size)u=null;u!=jb&&(l=!0)}null!=u?h[p]=u:l=!0}if(l){for(var O in h){g=h;break a}g=null}}g!=c&&(f=!0);a--}for(p=+!!(e&512)-1;0<a;a--){O=a-1;c=b[O];O-=p;if(!(null==c||P(c,d,O)||Ca(c)&&0===c.size))break;var kb=!0}if(!f&&!kb)return b;b=Array.prototype.slice.call(b,
  0,a);g&&b.push(g);return b};function Va(a){return function(b){if(null==b||""==b)b=new a;else{b=JSON.parse(b);if(!Array.isArray(b))throw Error(void 0);xa(b,32);b=Fa(a,b)}return b}};function Wa(a){this.h=R(a)}r(Wa,T);var Xa=Va(Wa);var U;function V(a){this.g=a}V.prototype.toString=function(){return this.g+""};var Ya={};function Za(a){if(void 0===U){var b=null;var c=t.trustedTypes;if(c&&c.createPolicy){try{b=c.createPolicy("goog#html",{createHTML:v,createScript:v,createScriptURL:v})}catch(d){t.console&&t.console.error(d.message)}U=b}else U=b}a=(b=U)?b.createScriptURL(a):a;return new V(a,Ya)};function $a(){return Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)};function ab(a,b){b=String(b);"application/xhtml+xml"===a.contentType&&(b=b.toLowerCase());return a.createElement(b)}function bb(a){this.g=a||t.document||document};/*
  
   SPDX-License-Identifier: Apache-2.0
  */
  function cb(a,b){a.src=b instanceof V&&b.constructor===V?b.g:"type_error:TrustedResourceUrl";var c,d;(c=(b=null==(d=(c=(a.ownerDocument&&a.ownerDocument.defaultView||window).document).querySelector)?void 0:d.call(c,"script[nonce]"))?b.nonce||b.getAttribute("nonce")||"":"")&&a.setAttribute("nonce",c)};function db(a){a=void 0===a?document:a;return a.createElement("script")};function eb(a,b,c,d,e,f){try{var g=a.g,h=db(g);h.async=!0;cb(h,b);g.head.appendChild(h);h.addEventListener("load",function(){e();d&&g.head.removeChild(h)});h.addEventListener("error",function(){0<c?eb(a,b,c-1,d,e,f):(d&&g.head.removeChild(h),f())})}catch(l){f()}};var fb=t.atob("aHR0cHM6Ly93d3cuZ3N0YXRpYy5jb20vaW1hZ2VzL2ljb25zL21hdGVyaWFsL3N5c3RlbS8xeC93YXJuaW5nX2FtYmVyXzI0ZHAucG5n"),gb=t.atob("WW91IGFyZSBzZWVpbmcgdGhpcyBtZXNzYWdlIGJlY2F1c2UgYWQgb3Igc2NyaXB0IGJsb2NraW5nIHNvZnR3YXJlIGlzIGludGVyZmVyaW5nIHdpdGggdGhpcyBwYWdlLg=="),hb=t.atob("RGlzYWJsZSBhbnkgYWQgb3Igc2NyaXB0IGJsb2NraW5nIHNvZnR3YXJlLCB0aGVuIHJlbG9hZCB0aGlzIHBhZ2Uu");function ib(a,b,c){this.i=a;this.u=b;this.o=c;this.g=null;this.j=[];this.m=!1;this.l=new bb(this.i)}
  function lb(a){if(a.i.body&&!a.m){var b=function(){mb(a);t.setTimeout(function(){nb(a,3)},50)};eb(a.l,a.u,2,!0,function(){t[a.o]||b()},b);a.m=!0}}
  function mb(a){for(var b=W(1,5),c=0;c<b;c++){var d=X(a);a.i.body.appendChild(d);a.j.push(d)}b=X(a);b.style.bottom="0";b.style.left="0";b.style.position="fixed";b.style.width=W(100,110).toString()+"%";b.style.zIndex=W(2147483544,2147483644).toString();b.style.backgroundColor=ob(249,259,242,252,219,229);b.style.boxShadow="0 0 12px #888";b.style.color=ob(0,10,0,10,0,10);b.style.display="flex";b.style.justifyContent="center";b.style.fontFamily="Roboto, Arial";c=X(a);c.style.width=W(80,85).toString()+
  "%";c.style.maxWidth=W(750,775).toString()+"px";c.style.margin="24px";c.style.display="flex";c.style.alignItems="flex-start";c.style.justifyContent="center";d=ab(a.l.g,"IMG");d.className=$a();d.src=fb;d.alt="Warning icon";d.style.height="24px";d.style.width="24px";d.style.paddingRight="16px";var e=X(a),f=X(a);f.style.fontWeight="bold";f.textContent=gb;var g=X(a);g.textContent=hb;Y(a,e,f);Y(a,e,g);Y(a,c,d);Y(a,c,e);Y(a,b,c);a.g=b;a.i.body.appendChild(a.g);b=W(1,5);for(c=0;c<b;c++)d=X(a),a.i.body.appendChild(d),
  a.j.push(d)}function Y(a,b,c){for(var d=W(1,5),e=0;e<d;e++){var f=X(a);b.appendChild(f)}b.appendChild(c);c=W(1,5);for(d=0;d<c;d++)e=X(a),b.appendChild(e)}function W(a,b){return Math.floor(a+Math.random()*(b-a))}function ob(a,b,c,d,e,f){return"rgb("+W(Math.max(a,0),Math.min(b,255)).toString()+","+W(Math.max(c,0),Math.min(d,255)).toString()+","+W(Math.max(e,0),Math.min(f,255)).toString()+")"}function X(a){a=ab(a.l.g,"DIV");a.className=$a();return a}
  function nb(a,b){0>=b||null!=a.g&&0!==a.g.offsetHeight&&0!==a.g.offsetWidth||(pb(a),mb(a),t.setTimeout(function(){nb(a,b-1)},50))}function pb(a){for(var b=m(a.j),c=b.next();!c.done;c=b.next())(c=c.value)&&c.parentNode&&c.parentNode.removeChild(c);a.j=[];(b=a.g)&&b.parentNode&&b.parentNode.removeChild(b);a.g=null};function qb(a,b,c,d,e){function f(l){document.body?g(document.body):0<l?t.setTimeout(function(){f(l-1)},e):b()}function g(l){l.appendChild(h);t.setTimeout(function(){h?(0!==h.offsetHeight&&0!==h.offsetWidth?b():a(),h.parentNode&&h.parentNode.removeChild(h)):a()},d)}var h=rb(c);f(3)}function rb(a){var b=document.createElement("div");b.className=a;b.style.width="1px";b.style.height="1px";b.style.position="absolute";b.style.left="-10000px";b.style.top="-10000px";b.style.zIndex="-10000";return b};function Ra(a){this.h=R(a)}r(Ra,T);function sb(a){this.h=R(a)}r(sb,T);var tb=Va(sb);function ub(a){var b=la.apply(1,arguments);if(0===b.length)return Za(a[0]);for(var c=a[0],d=0;d<b.length;d++)c+=encodeURIComponent(b[d])+a[d+1];return Za(c)};function vb(a){if(!a)return null;a=Sa(a,4);var b;null===a||void 0===a?b=null:b=Za(a);return b};var wb=ea([""]),xb=ea([""]);function yb(a,b){this.m=a;this.o=new bb(a.document);this.g=b;this.j=S(this.g,1);this.u=vb(Qa(this.g,2))||ub(wb);this.i=!1;b=vb(Qa(this.g,13))||ub(xb);this.l=new ib(a.document,b,S(this.g,12))}yb.prototype.start=function(){zb(this)};
  function zb(a){Ab(a);eb(a.o,a.u,3,!1,function(){a:{var b=a.j;var c=t.btoa(b);if(c=t[c]){try{var d=Xa(t.atob(c))}catch(e){b=!1;break a}b=b===Sa(d,1)}else b=!1}b?Z(a,S(a.g,14)):(Z(a,S(a.g,8)),lb(a.l))},function(){qb(function(){Z(a,S(a.g,7));lb(a.l)},function(){return Z(a,S(a.g,6))},S(a.g,9),Ta(a.g,10),Ta(a.g,11))})}function Z(a,b){a.i||(a.i=!0,a=new a.m.XMLHttpRequest,a.open("GET",b,!0),a.send())}function Ab(a){var b=t.btoa(a.j);a.m[b]&&Z(a,S(a.g,5))};(function(a,b){t[a]=function(){var c=la.apply(0,arguments);t[a]=function(){};b.call.apply(b,[null].concat(c instanceof Array?c:fa(m(c))))}})("__h82AlnkH6D91__",function(a){"function"===typeof window.atob&&(new yb(window,tb(window.atob(a)))).start()});}).call(this);
  
  window.__h82AlnkH6D91__("WyJwdWItMzQxMTc4NDE1NzU0MzQyMCIsW251bGwsbnVsbCxudWxsLCJodHRwczovL2Z1bmRpbmdjaG9pY2VzbWVzc2FnZXMuZ29vZ2xlLmNvbS9iL3B1Yi0zNDExNzg0MTU3NTQzNDIwIl0sbnVsbCxudWxsLCJodHRwczovL2Z1bmRpbmdjaG9pY2VzbWVzc2FnZXMuZ29vZ2xlLmNvbS9lbC9BR1NLV3hXcFo2SEZhZ2tXV3BBeDkyVm5FUm1HelA4Sng3NDBjbG82QTd1U1BzMjMtb1J6aTl0R2tJZC0ySTZkbU9kVExldXJ5VU5pdDJmWVl6cVN3ZXFSaHFtT1d3XHUwMDNkXHUwMDNkP3RlXHUwMDNkVE9LRU5fRVhQT1NFRCIsImh0dHBzOi8vZnVuZGluZ2Nob2ljZXNtZXNzYWdlcy5nb29nbGUuY29tL2VsL0FHU0tXeFVub2h4aTRwNDRvRHN5UjNjSzBTTlVWdlhldmoySHp3dHBPMk52dlF4SXpPc1RuT1E4ZXV1Qzc4UExTRzROMFplT28xRWF6MG5hYjVHNElnMGJ5M1RqTkFcdTAwM2RcdTAwM2Q/YWJcdTAwM2QxXHUwMDI2c2JmXHUwMDNkMSIsImh0dHBzOi8vZnVuZGluZ2Nob2ljZXNtZXNzYWdlcy5nb29nbGUuY29tL2VsL0FHU0tXeFU0c2VpaDRuem1aQ2VKc0s0OUpFdHNBT3ZIZkNGaE9yMXFDN3N5bzRSaHBmamQzay02OGlaakhUT0UybWlxTEx6SnpZYUFPZHhTYWVRMC1LMGRZc0VabWdcdTAwM2RcdTAwM2Q/YWJcdTAwM2QyXHUwMDI2c2JmXHUwMDNkMSIsImh0dHBzOi8vZnVuZGluZ2Nob2ljZXNtZXNzYWdlcy5nb29nbGUuY29tL2VsL0FHU0tXeFdROU1sNExITHNkMVg0RzJualpOUXBhVE1GVzVTU2RUb0hUVF9oU1F6OVI3cm1RSVZsR3kzOFgyMng0dDZSVHJLdTVRaUlrdkl0ZFd2TFJ1Mnl2SEVaTXdcdTAwM2RcdTAwM2Q/c2JmXHUwMDNkMiIsImRpdi1ncHQtYWQiLDIwLDEwMCwiY0hWaUxUTTBNVEUzT0RReE5UYzFORE0wTWpBXHUwMDNkIixbbnVsbCxudWxsLG51bGwsImh0dHBzOi8vd3d3LmdzdGF0aWMuY29tLzBlbW4vZi9wL3B1Yi0zNDExNzg0MTU3NTQzNDIwLmpzP3VzcXBcdTAwM2RDQkkiXSwiaHR0cHM6Ly9mdW5kaW5nY2hvaWNlc21lc3NhZ2VzLmdvb2dsZS5jb20vZWwvQUdTS1d4V3YwN0dzbGhnVi1oUV85a0wzV0FhN0hmUXo3dXhKTWFBLUtHQ3VMOUhrWmRVWEFneHNmcVdIYUJrZlhBZkF1TUdyM2hFTmVMeVhZZDItS25ublNQODdwZ1x1MDAzZFx1MDAzZCJd");</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="shortcut icon" href="/assets/img/favicon.ico">

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Shawn Hsu
          <span class="site-subtitle">Shawn Hsu's personal study blog | Software Engineer | Backend | Cloud Native | Blockchain</span>
        </a>
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li>
<li class="masthead__menu-item">
              <a href="/categories/">Categories</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags/">Tags</a>
            </li>
</ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      




  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/" itemprop="item"><span itemprop="name">Home</span></a>

          <meta itemprop="position" content="1">
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/categories/#random" itemprop="item"><span itemprop="name">Random</span></a>
          <meta itemprop="position" content="2">
        </li>
        <span class="sep">/</span>
      
    
      
      
        <li class="current">Goroutine 與 Channel 的共舞</li>
      
    
  </ol>
</nav>

  


<script>
  document.addEventListener("DOMContentLoaded", function () {
    const sidebarNav = document.querySelector("nav.toc");
    if (!sidebarNav) {
      return;
    }

    // Find the actual scrollable container
    let scrollContainer = null;

    // Check if the nav itself is scrollable
    if (sidebarNav.scrollHeight > sidebarNav.offsetHeight) {
      scrollContainer = sidebarNav;
    } else {
      // Look for scrollable children
      const tocMenu = sidebarNav.querySelector(".toc__menu");
      if (tocMenu && tocMenu.scrollHeight > tocMenu.offsetHeight) {
        scrollContainer = tocMenu;
      } else {
        // Look for any scrollable child
        const children = sidebarNav.children;
        for (let child of children) {
          if (child.scrollHeight > child.offsetHeight) {
            scrollContainer = child;
            break;
          }
        }
      }
    }

    if (!scrollContainer) {
      return;
    }

    let isUserScrolling = false;
    let autoScrollEnabled = true;
    let scrollTimeout;
    let pageScrollTimeout;
    let periodicCheckInterval;

    // Function to check if element is visible in container
    const isElementVisible = (element) => {
      const containerTop = scrollContainer.scrollTop;
      const containerHeight = scrollContainer.offsetHeight;
      const elementTop = element.offsetTop;
      const elementHeight = element.offsetHeight;

      const isVisible =
        elementTop >= containerTop &&
        elementTop + elementHeight <= containerTop + containerHeight;

      return isVisible;
    };

    // Function to find the current active heading based on scroll position
    const findCurrentActiveHeading = () => {
      const headings = document.querySelectorAll(
        "h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]"
      );
      const scrollY = window.scrollY;
      const offset = 100; // Offset to trigger activation

      let currentHeading = null;

      // Find the heading that's currently at the top of the viewport
      for (let i = 0; i < headings.length; i++) {
        const heading = headings[i];
        const headingTop = heading.offsetTop;

        if (headingTop <= scrollY + offset) {
          currentHeading = heading;
        } else {
          break;
        }
      }

      return currentHeading;
    };

    // Function to find the TOC element that corresponds to a heading
    const findTocElementForHeading = (heading) => {
      if (!heading || !heading.id) return null;

      const tocLinks = document.querySelectorAll("nav.toc a");
      for (const link of tocLinks) {
        if (link.getAttribute("href") === `#${heading.id}`) {
          return link.closest("li");
        }
      }
      return null;
    };

    // Function to scroll TOC to show active element
    const scrollTocToActive = () => {
      // Don't auto-scroll if user is manually scrolling or auto-scroll is disabled
      if (isUserScrolling || !autoScrollEnabled) {
        return;
      }

      // Always use scroll position to find the current heading
      const currentHeading = findCurrentActiveHeading();
      if (!currentHeading) {
        return;
      }

      const activeElement = findTocElementForHeading(currentHeading);
      if (!activeElement) {
        return;
      }

      // Check if active element is visible
      if (!isElementVisible(activeElement)) {
        // Get the current scroll position and container dimensions
        const currentScrollTop = scrollContainer.scrollTop;
        const containerHeight = scrollContainer.offsetHeight;
        const elementTop = activeElement.offsetTop;
        const elementHeight = activeElement.offsetHeight;

        // Calculate the position to center the active element in the visible area
        const targetScrollTop =
          elementTop - containerHeight / 2 + elementHeight / 2;

        // Ensure we don't scroll beyond the bounds
        const maxScrollTop = scrollContainer.scrollHeight - containerHeight;
        const finalScrollTop = Math.max(
          0,
          Math.min(targetScrollTop, maxScrollTop)
        );

        // Scroll to the target position
        scrollContainer.scrollTo({
          top: finalScrollTop,
          behavior: "smooth",
        });
      }
    };

    // Function to enable auto-scroll
    const enableAutoScroll = () => {
      if (!autoScrollEnabled) {
        autoScrollEnabled = true;
        // Resume periodic checks
        startPeriodicCheck();
      }
    };

    // Function to disable auto-scroll
    const disableAutoScroll = () => {
      if (autoScrollEnabled) {
        autoScrollEnabled = false;
        // Stop periodic checks
        if (periodicCheckInterval) {
          clearInterval(periodicCheckInterval);
          periodicCheckInterval = null;
        }
      }
    };

    // Function to start periodic check
    const startPeriodicCheck = () => {
      if (!periodicCheckInterval) {
        periodicCheckInterval = setInterval(() => {
          scrollTocToActive();
        }, 5000); // Increased interval to 5 seconds
      }
    };

    // Handle TOC scrolling
    scrollContainer.addEventListener("scroll", () => {
      isUserScrolling = true;
      disableAutoScroll(); // Disable auto-scroll when user scrolls TOC

      if (scrollTimeout) {
        clearTimeout(scrollTimeout);
      }

      scrollTimeout = setTimeout(() => {
        isUserScrolling = false;
        // Don't automatically re-enable auto-scroll here
        // It will be re-enabled when user interacts with main page
      }, 500);
    });

    // Handle page scrolling
    window.addEventListener("scroll", () => {
      enableAutoScroll(); // Re-enable auto-scroll when user scrolls main page

      if (pageScrollTimeout) {
        clearTimeout(pageScrollTimeout);
      }

      pageScrollTimeout = setTimeout(() => {
        scrollTocToActive();
      }, 100);
    });

    // Handle clicks on main page content
    document.addEventListener("click", (event) => {
      // Only enable auto-scroll if click is not on TOC
      if (!sidebarNav.contains(event.target)) {
        enableAutoScroll();
      }
    });

    // Handle keyboard navigation
    document.addEventListener("keydown", () => {
      enableAutoScroll();
    });

    // Initial scroll to active element
    setTimeout(() => {
      scrollTocToActive();
    }, 1000);

    // Start periodic check
    startPeriodicCheck();
  });
</script>


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person" class="h-card">

  

  <div class="author__content">
    <h3 class="author__name p-name" itemprop="name">
      <a class="u-url" rel="me" href="https://ambersuncreates.com/" itemprop="url">Shawn Hsu</a>
    </h3>
    
      <div class="author__bio p-note" itemprop="description">
        <p>For it isn’t by size that you win or fail</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name" class="p-locality">Taipei, Taiwan</span>
        </li>
      

      
        
          
        
          
        
          
        
          
            <li><a href="https://github.com/ambersun1234" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
        
          
            <li><a href="https://www.linkedin.com/in/ambersun1234" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
      

      

      
        <li>
          <a href="mailto:ambersun1019.shawn@gmail.com" rel="me" class="u-email">
            <meta itemprop="email" content="ambersun1019.shawn@gmail.com">
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span>
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer me">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Goroutine 與 Channel 的共舞">
    <meta itemprop="description" content="Preface在了解 Channel 之前，我們需要先了解一些基本的概念如果你已經很熟悉這些概念，可以直接跳到 Introduction to Golang Channel 部分">
    <meta itemprop="datePublished" content="2023-03-25T00:00:00+08:00">
    <meta itemprop="dateModified" content="2025-12-17T21:45:59+08:00">

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title p-name" itemprop="headline">
            <a href="https://ambersuncreates.com/random/golang-channel/" class="u-url" itemprop="url">Goroutine 與 Channel 的共舞
</a>
          </h1>
          


  <p class="page__meta">
    

    

    
      
      

      

         

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          13 minute read
        
      </span>

         

      <span class="page__meta-readtime">
        <i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i>Posted on:
        <time class="dt-published" datetime="2023-03-25">2023-03-25</time>
      </span>

      
           
        
        <span class="page__meta-readtime">
          <i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i>Updated on:
          <time class="dt-published" datetime="2025-12-17">
            2025-12-17
          </time>
        </span>

           

        <span>
          <i class="fas fa-eye" aria-hidden="true"></i>
          Views: <span id="view-field-/random/golang-channel/"> Loading...</span>
        </span>
      
    
  </p>


<script>
  fetch(`https://api.ambersuncreates.com/views?url=/random/golang-channel/`)
    .then(async (response) => {
      if (response.ok) {
        data = await response.json();

        let text = "-";
        if (data.views > 100) {
          text = Intl.NumberFormat('en', { notation: 'compact' }).format(data.views);
        }
        document.getElementById("view-field-/random/golang-channel/").innerHTML = text;
      }
    })
</script>

        </header>
      

      <section class="page__content e-content" itemprop="text" style="margin-top: 2em">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title">
<i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu">
<li><a href="#preface">Preface</a></li>
<li>
<a href="#synchronous-vs-asynchronous-io">Synchronous vs. Asynchronous I/O</a><ul>
<li><a href="#blocking-send">Blocking Send</a></li>
<li><a href="#blocking-receive">Blocking Receive</a></li>
<li><a href="#non-blocking-send">Non-blocking Send</a></li>
<li><a href="#non-blocking-receive">Non-blocking Receive</a></li>
</ul>
</li>
<li>
<a href="#buffer">Buffer</a><ul>
<li><a href="#zero-capacity-buffer">Zero Capacity Buffer</a></li>
<li><a href="#bounded-capacity-buffer">Bounded Capacity Buffer</a></li>
<li><a href="#unbounded-capacity-buffer">Unbounded Capacity Buffer</a></li>
</ul>
</li>
<li>
<a href="#ring-buffer">Ring Buffer</a><ul>
<li><a href="#counter-approach">Counter Approach</a></li>
<li><a href="#last-operation-approach">Last Operation Approach</a></li>
<li><a href="#store-only-size---1-element">Store only Size - 1 Element</a></li>
<li><a href="#mirror-approach">Mirror Approach</a></li>
</ul>
</li>
<li>
<a href="#inter-process-communication">Inter-Process Communication</a><ul>
<li><a href="#shared-memory">Shared Memory</a></li>
<li>
<a href="#message-passing">Message Passing</a><ul>
<li><a href="#direct-communication">Direct Communication</a></li>
<li><a href="#indirect-communication">Indirect Communication</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#introduction-to-golang-channel">Introduction to Golang Channel</a><ul>
<li>
<a href="#how-does-channel-work">How does Channel Work</a><ul>
<li><a href="#send-on-channel">Send on Channel</a></li>
<li><a href="#receive-on-channel">Receive on Channel</a></li>
</ul>
</li>
<li><a href="#explicit-close-channel">Explicit Close Channel</a></li>
<li><a href="#share-memory-by-communicating">Share Memory by Communicating</a></li>
</ul>
</li>
<li>
<a href="#select-on-channel">Select on Channel</a><ul><li><a href="#nil-value-from-channel">Nil Value from Channel</a></li></ul>
</li>
<li><a href="#producer-consumer-example">Producer Consumer Example</a></li>
<li><a href="#references">References</a></li>
</ul>

            </nav>

            <br>

            <div class="sidebar__top_down" style="display: flex;">
              <div>
                <nav style="padding: 0 0.5em;">
                  <a href="#site-nav"> <i class="fas fa-angle-double-up fa-2x"></i></a>
                </nav>
              </div>

              <div>
                <nav style="padding: 0 0.5em;">
                  <a href="#footer"> <i class="fas fa-angle-double-down fa-2x"></i></a>
                </nav>
              </div>
            </div>

            
          </aside>
        
        <h1 id="preface">Preface</h1>
<p>在了解 Channel 之前，我們需要先了解一些基本的概念<br>
如果你已經很熟悉這些概念，可以直接跳到 <a href="#introduction-to-golang-channel">Introduction to Golang Channel</a> 部分</p>

<h1 id="synchronous-vs-asynchronous-io">Synchronous vs. Asynchronous I/O</h1>
<h2 id="blocking-send">Blocking Send</h2>
<p>在 receiver 收到資料之前，sender 不能在傳資料</p>

<h2 id="blocking-receive">Blocking Receive</h2>
<p>在下一個資料送抵之前，receiver 會一直 block</p>

<h2 id="non-blocking-send">Non-blocking Send</h2>
<p>一直送資料，不管你有沒有收到</p>

<h2 id="non-blocking-receive">Non-blocking Receive</h2>
<p>一直收資料，不管你有沒有送</p>

<h1 id="buffer">Buffer</h1>
<p>buffer 是用於暫存資料的一個空間，此時的資料是屬於 <strong>尚未處理過的</strong></p>

<blockquote>
  <p>c.f. <a href="../../database/database-cache#cache-vs-buffer">資料庫 - Cache Strategies 與常見的 Solutions | Shawn Hsu</a></p>
</blockquote>

<h2 id="zero-capacity-buffer">Zero Capacity Buffer</h2>
<p>亦即沒有一個暫存空間，這會導致在 receiver 處理完資料之前，sender 必須等待(也就是所謂的 <code class="language-plaintext highlighter-rouge">rendezvous</code>)<br>
在這個情況下，是屬於 blocking I/O</p>

<h2 id="bounded-capacity-buffer">Bounded Capacity Buffer</h2>
<p>bounded buffer 指的是這是一塊大小大於 0 的空間<br>
當 buffer 已經填滿的情況下 sender 如果繼續送資料有可能導致</p>
<ul>
  <li>錯誤</li>
  <li>或是直接扔掉</li>
</ul>

<h2 id="unbounded-capacity-buffer">Unbounded Capacity Buffer</h2>
<p>unbounded buffer 的大小為無上限(端看你機器有多大的 memory size)<br>
但通常這個狀況是不建議的<br>
我想理由也很簡單<br>
如果說資料來不及消化，輕則 application crash 重則你的電腦掛掉</p>

<p>在這個情況下，sender 是不需要進行等待的</p>

<h1 id="ring-buffer">Ring Buffer</h1>
<p>ring buffer 是一種特殊的資料結構，用以處理固定大小的資料<br>
其實作通常是使用 circular queue，並頭尾相連</p>

<p>ring buffer 的好處如下</p>
<ul>
  <li>存取的時間複雜度為 $O(1)$, 而 linked list 則為 $O(n)$</li>
  <li>ring buffer 空間大小固定，可以較省空間</li>
  <li>當取出 data, 其餘的資料不需要做移動</li>
</ul>

<p>ring buffer 由於頭尾相連的特性，因此在實作上需要注意一個細節<br>
也就是我要怎麼分別 queue 是滿的還是空的 的情況<br>
因為這兩種情況，他的 head 是等於 tail 的<br>
這裡有幾個不一樣的判斷方法供參考</p>

<h2 id="counter-approach">Counter Approach</h2>
<p>最簡單的方法之一，既然 ring buffer 是固定大小的，那我加一個 counter variable 紀錄當前有多少 data 在 buffer 裡面就可以判斷是否為空值或者是已經滿了<br>
唯一的缺點就是，多執行緒的情況下 counter variable 需要注意 race condition(可以用 mutex lock)</p>

<p>另一種的計數方法是分別紀錄讀寫次數，相差多少即為目前資料數量<br>
不過我覺的既然都要記次數了，就沒必要紀錄兩次就是</p>

<h2 id="last-operation-approach">Last Operation Approach</h2>
<p>當 read/write index 相等的同時，我們知道會有兩種狀況<br>
而紀錄最後的操作為何可以幫助我們分辨</p>

<ul>
  <li>最後的操作為 write <img class="emoji" title=":arrow_right:" alt=":arrow_right:" src="https://github.githubassets.com/images/icons/emoji/unicode/27a1.png" height="20" width="20"> buffer 滿了</li>
  <li>最後的操作為 read <img class="emoji" title=":arrow_right:" alt=":arrow_right:" src="https://github.githubassets.com/images/icons/emoji/unicode/27a1.png" height="20" width="20"> buffer 為空</li>
</ul>

<p>不難想到它也需要一個 variable 紀錄 last op<br>
缺點也同上一個，多執行緒下需要進行 lock 保護資料</p>

<h2 id="store-only-size---1-element">Store only Size - 1 Element</h2>
<p>ring buffer 一定會有的資料結構是，一個 read index 一個 write index<br>
基本的 ring buffer 概念, 有資料才能讀 <img class="emoji" title=":arrow_right:" alt=":arrow_right:" src="https://github.githubassets.com/images/icons/emoji/unicode/27a1.png" height="20" width="20"> write index 相較於 read index 一定會比較後面(資料寫進去之後你才能讀取)<br>
當 write index 超過 read index 的時候，就代表滿了 嗎<br>
對 但是 buffer 滿的同時，你也不小心蓋掉了一個 element，而且是還沒有讀取過的</p>

<p>所以我們只能在它滿之前判斷出來，阿我們也不能用 read index == write index(因為它包含了兩種語意)<br>
所以，要在 buffer 還剩一個空位的時候判斷，這時候 <code class="language-plaintext highlighter-rouge">write index + 1 = read index</code><br>
公式為 <code class="language-plaintext highlighter-rouge">(read index - 1) % length == write index</code><br>
而此時 write index 上面是沒有資料的<br>
只能儲存 size - 1 個資料的原因在這</p>

<p>舉個例子, ring buffer 的大小為 5</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left"> </th>
      <th style="text-align: center">start</th>
      <th style="text-align: center"> </th>
      <th style="text-align: center"> </th>
      <th style="text-align: center"> </th>
      <th style="text-align: center"> </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">index</td>
      <td style="text-align: center">0</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">2</td>
      <td style="text-align: center">3</td>
      <td style="text-align: center">4</td>
    </tr>
    <tr>
      <td style="text-align: left"> </td>
      <td style="text-align: center">read<br>write</td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
    </tr>
  </tbody>
</table>

<p>寫了 4 筆資料之後，圖會長這樣</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left"> </th>
      <th style="text-align: center">start</th>
      <th style="text-align: center"> </th>
      <th style="text-align: center"> </th>
      <th style="text-align: center"> </th>
      <th style="text-align: center"> </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">index</td>
      <td style="text-align: center">0</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">2</td>
      <td style="text-align: center">3</td>
      <td style="text-align: center">4</td>
    </tr>
    <tr>
      <td style="text-align: left"> </td>
      <td style="text-align: center">read</td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">write</td>
    </tr>
  </tbody>
</table>

<p>注意到此時 index 4 上面是沒有資料的<br>
用公式計算是否已經滿了 <code class="language-plaintext highlighter-rouge">(0 - 1) % 5 == 4</code> <img class="emoji" title=":arrow_right:" alt=":arrow_right:" src="https://github.githubassets.com/images/icons/emoji/unicode/27a1.png" height="20" width="20"> true</p>

<blockquote>
  <p>也可以動手算算看，把 start 位置定在任意位置，ring buffer 不限制你從哪裡開始寫資料</p>
</blockquote>

<h2 id="mirror-approach">Mirror Approach</h2>
<p>維基百科上面寫的太難了<br>
想的簡單點，它跟 <a href="#counter-approach">Counter Approach</a> 很像<br>
除了 read/write index 以外，它引入了 read/write pointer 分別紀錄目前寫到了哪裡<br>
你說 index 不就可以紀錄當前位置了嗎？ 問題是 read index == write index 的判斷是語意不清楚的</p>

<p>Mirror Approach 說，我讓 pointer 紀錄的位置長達 <code class="language-plaintext highlighter-rouge">2n</code><br>
也就是 read/write index 的區間為 <code class="language-plaintext highlighter-rouge">0 到 n - 1</code>，而 read/write pointer 的區間為 <code class="language-plaintext highlighter-rouge">0 到 2n - 1</code><br>
每次的寫入讀取，index 與 pointer 都往後移動一個位置<br>
所以你可以把 pointer 想像成，目前寫了多少資料進去 ring buffer 裡面<br>
亦即 read pointer 就是 <code class="language-plaintext highlighter-rouge">已經讀取個數</code>，而 write pointer 為 <code class="language-plaintext highlighter-rouge">已經寫入個數</code><br>
那麼，如果 read pointer == write pointer, 換成中文的意思就是，<strong>已經讀取個數等於已經寫入個數</strong><br>
不就是 counter approach 的思想了嗎</p>

<blockquote>
  <p>read/write pointer 只會一直遞增，當超過 2n 的時候，就回到 0<br>
read/write pointer 最多只會相差 n<br>
實際上可用空間只有 0 ~ n - 1 而已，pointer 只是起到紀錄的作用，不代表可以用到 2n 這麼多空間</p>
</blockquote>

<p>兩個 condition 合併起來，當 <code class="language-plaintext highlighter-rouge">read index == write index &amp;&amp; read pointer == write pointer</code> 的時候，是不是就表明，<strong>ring buffer 已經滿了</strong><br>
當 <code class="language-plaintext highlighter-rouge">read index != write index &amp;&amp; read pointer == write pointer</code> 的時候，代表 <strong>ring buffer 為空</strong></p>

<p>如果 ring buffer 長度為 2 的次方，可以簡化判斷式為 <code class="language-plaintext highlighter-rouge">write pointer == (read pointer xor n)</code></p>
<blockquote>
  <p>n 為 2 的次方，亦即在二進位表示法中，只會有一個 bit 會有資料而已，所以如果 read/write pointer 只差一個 bit 就代表目前讀寫相差 n 個 element</p>
</blockquote>

<p>這個方法的好處就是，不會像是 <a href="#store-only-size---1-element">Store only Size - 1 Element</a> 有空間沒利用到<br>
Mirror Approach 可以完整利用到全部空間</p>

<blockquote>
  <p>可參考 <a href="https://hackmd.io/@ambersun1234/2021linux_final">2020q1 Homework (期末專題)</a></p>
</blockquote>

<h1 id="inter-process-communication">Inter-Process Communication</h1>
<p><img src="https://www.w3schools.in/wp-content/uploads/2017/10/communications-models.png" alt=""></p>

<h2 id="shared-memory">Shared Memory</h2>
<p>顧名思義，是指兩個 process 共享一塊記憶體空間，將資料放進去這塊空間，從空間將資料讀出來的一個作法<br>
也因為你是共享 <em>一塊空間</em>, 所以非常適合用於傳輸大量資料</p>

<p>kernel 僅須在建立 shared memory 的一開始介入，後續可以讓 process 之間處理<br>
也因此，shared memory 的速度較快速(因為不用 kernel 幫忙)</p>

<blockquote>
  <p>process 的本質是與其他 process 相互隔離的，因此在實作上會相對困難，弄不好會有安全問題</p>
</blockquote>

<h2 id="message-passing">Message Passing</h2>
<p>使用 message passing 的機制可以讓 process 之間互相 <strong>同步(synchronize)</strong><br>
也因為它並不是採用共享空間的作法，因此 message passing 也可以應用在 distributed system 上面</p>

<p>message passing 基本上都會實作兩個 function</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">send</code></li>
  <li><code class="language-plaintext highlighter-rouge">receive</code></li>
</ul>

<h3 id="direct-communication">Direct Communication</h3>
<p>process 之間溝通的 communication link 為自動建立的<br>
communication link 的建立是透過 kernel 完成的<br>
與 shared memory 不一樣的是，message passing <strong>每次都必須要經過 kernel</strong></p>

<p>舉例來說</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td>
<td class="rouge-code"><pre>P: send(Q, message)
Q: receive(P, message)
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>兩個 process P 以及 Q, 分別透過 <code class="language-plaintext highlighter-rouge">send</code> 與 <code class="language-plaintext highlighter-rouge">receive</code> 進行溝通<br>
這樣的溝通方式稱之為 <code class="language-plaintext highlighter-rouge">symmetric communication</code></p>

<p>另一種則是 <code class="language-plaintext highlighter-rouge">asymmetric communication</code><br>
也就是</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td>
<td class="rouge-code"><pre>P: send(Q, message)
Q: receive(message)
</pre></td>
</tr></tbody></table></code></pre></div></div>
<p>與 symmetric communication 不同的是，receiver 並不知道訊息是從何而來的<br>
它指關心有沒有收到資料而已</p>

<p>我就好奇啦，為什麼要區分這兩種方式？ 它又有什麼好處<br>
asymmetric 的方式不會帶 message source, 意味著資料量可以減少<br>
別忘了，message passing 是透過 kernel 進行處理的，少幾個 bit 都能夠一定程度的減少 overhead</p>

<h3 id="indirect-communication">Indirect Communication</h3>
<p>與直接建立 communication link 不同，你也可以透過 mailbox 或是 port 的方式進行溝通<br>
同樣的，這些基礎設施都是 kernel 幫忙建立維護的</p>

<p>P 將資料放到 mailbox 裡面，Q 則從 mailbox 裡將資料取出<br>
你說這不就是 shared memory 嗎？<br>
對 但是這塊 memory 並不是 process 自己處理的，是 kernel 負責維護的，所以它算是 message passing</p>

<hr>

<table>
  <thead>
    <tr>
      <th style="text-align: center"> </th>
      <th style="text-align: left">Shared Memory</th>
      <th style="text-align: left">Message Passing</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Communication</td>
      <td style="text-align: left">透過一塊共享空間</td>
      <td style="text-align: left">透過 kernel 提供的 message passing 設施</td>
    </tr>
    <tr>
      <td style="text-align: center">Data Size</td>
      <td style="text-align: left">大</td>
      <td style="text-align: left">小</td>
    </tr>
    <tr>
      <td style="text-align: center">Location</td>
      <td style="text-align: left">適用於同一台機器</td>
      <td style="text-align: left">適用於分散式系統或同一台機器</td>
    </tr>
    <tr>
      <td style="text-align: center">Speed</td>
      <td style="text-align: left">快</td>
      <td style="text-align: left">慢</td>
    </tr>
    <tr>
      <td style="text-align: center">kernel Intervention</td>
      <td style="text-align: left">kernel 不介入</td>
      <td style="text-align: left">kernel 每次都介入處理</td>
    </tr>
  </tbody>
</table>

<h1 id="introduction-to-golang-channel">Introduction to Golang Channel</h1>
<p>多執行緒下溝通的方式，就如同前面所提到的 <a href="#shared-memory">shared memory</a> 或者是 <a href="#message-passing">message passing</a><br>
Golang 作為一個強大的語言，它建議我們，可以採用 channel 的方式進行溝通，共享資料<br>
所以 channel 本身是用來進行 <strong>資料的傳遞</strong>, 切記不要將它拿來當作 storage 用(會有效能問題而且它也不是設計來給你這樣用的)<br>
接下來讓我們看看作為與 goroutine 相輔相成的 channel 實際上是如何運作的吧</p>

<h2 id="how-does-channel-work">How does Channel Work</h2>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td>
<td class="rouge-code"><pre><span class="k">type</span> <span class="n">hchan</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">qcount</span>   <span class="kt">uint</span>           <span class="c">// total data in the queue</span>
    <span class="n">dataqsiz</span> <span class="kt">uint</span>           <span class="c">// size of the circular queue</span>
    <span class="n">buf</span>      <span class="n">unsafe</span><span class="o">.</span><span class="n">Pointer</span> <span class="c">// points to an array of dataqsiz elements</span>
    <span class="n">elemsize</span> <span class="kt">uint16</span>
    <span class="n">closed</span>   <span class="kt">uint32</span>
    <span class="n">elemtype</span> <span class="o">*</span><span class="n">_type</span> <span class="c">// element type</span>
    <span class="n">sendx</span>    <span class="kt">uint</span>   <span class="c">// send index</span>
    <span class="n">recvx</span>    <span class="kt">uint</span>   <span class="c">// receive index</span>
    <span class="n">recvq</span>    <span class="n">waitq</span>  <span class="c">// list of recv waiters</span>
    <span class="n">sendq</span>    <span class="n">waitq</span>  <span class="c">// list of send waiters</span>

    <span class="c">// lock protects all fields in hchan, as well as several</span>
    <span class="c">// fields in sudogs blocked on this channel.</span>
    <span class="c">//</span>
    <span class="c">// Do not change another G's status while holding this lock</span>
    <span class="c">// (in particular, do not ready a G), as this can deadlock</span>
    <span class="c">// with stack shrinking.</span>
    <span class="n">lock</span> <span class="n">mutex</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>hchan 的結構中，包含了一個儲存資料的 circular queue(<code class="language-plaintext highlighter-rouge">buf</code>) 以及其他相關 variable(<code class="language-plaintext highlighter-rouge">qcount</code>, <code class="language-plaintext highlighter-rouge">dataqsiz</code>, <code class="language-plaintext highlighter-rouge">elemsize</code>, <code class="language-plaintext highlighter-rouge">sendx</code> 以及 <code class="language-plaintext highlighter-rouge">receivex</code>)<br>
以及兩個 sender/receiver 的 wait queue(以 linked list 實作)<br>
最後則是配上一個 mutex lock 保護 hchan 的資料</p>

<p>channel 儲存資料的方式是使用一個 circular queue 進行實作，也就是 <a href="#ring-buffer">Ring Buffer</a><br>
golang 的 buf 是一個指向實際 ring buffer 的指標
<img src="https://www.readfog.com/assets/7f/02/7156a8f553394b4338589b1d2d4d.jpg" alt=""></p>
<blockquote>
  <p>ref: <a href="https://www.readfog.com/a/1651951565605539840">深入理解 Golang Channel 結構</a></p>
</blockquote>

<p>所以回到 hchan 的定義<br>
因此我們可以發現到，<code class="language-plaintext highlighter-rouge">sendx</code> 與 <code class="language-plaintext highlighter-rouge">receivex</code> 分別代表 send(write) index 與 receive(read) index</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre></td>
<td class="rouge-code"><pre><span class="k">func</span> <span class="n">makechan</span><span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">chantype</span><span class="p">,</span> <span class="n">size</span> <span class="kt">int64</span><span class="p">)</span> <span class="o">*</span><span class="n">hchan</span> <span class="p">{</span>
    <span class="o">...</span>

    <span class="n">mem</span><span class="p">,</span> <span class="n">overflow</span> <span class="o">:=</span> <span class="n">math</span><span class="o">.</span><span class="n">MulUintptr</span><span class="p">(</span><span class="n">elem</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="kt">uintptr</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">overflow</span> <span class="o">||</span> <span class="n">mem</span> <span class="o">&gt;</span> <span class="n">maxAlloc</span><span class="o">-</span><span class="n">hchanSize</span> <span class="o">||</span> <span class="n">size</span> <span class="o">&lt;</span> <span class="m">0</span> <span class="p">{</span>
        <span class="nb">panic</span><span class="p">(</span><span class="n">plainError</span><span class="p">(</span><span class="s">"makechan: size out of range"</span><span class="p">))</span>
    <span class="p">}</span>

    <span class="c">// Hchan does not contain pointers interesting for GC when elements stored in buf do not contain pointers.</span>
    <span class="c">// buf points into the same allocation, elemtype is persistent.</span>
    <span class="c">// SudoG's are referenced from their owning thread so they can't be collected.</span>
    <span class="c">// TODO(dvyukov,rlh): Rethink when collector can move allocated objects.</span>
    <span class="k">var</span> <span class="n">c</span> <span class="o">*</span><span class="n">hchan</span>
    <span class="k">switch</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">mem</span> <span class="o">==</span> <span class="m">0</span><span class="o">:</span>
        <span class="c">// Queue or element size is zero.</span>
        <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">hchan</span><span class="p">)(</span><span class="n">mallocgc</span><span class="p">(</span><span class="n">hchanSize</span><span class="p">,</span> <span class="no">nil</span><span class="p">,</span> <span class="no">true</span><span class="p">))</span>
        <span class="c">// Race detector uses this location for synchronization.</span>
        <span class="n">c</span><span class="o">.</span><span class="n">buf</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">raceaddr</span><span class="p">()</span>
    <span class="k">case</span> <span class="n">elem</span><span class="o">.</span><span class="n">ptrdata</span> <span class="o">==</span> <span class="m">0</span><span class="o">:</span>
        <span class="c">// Elements do not contain pointers.</span>
        <span class="c">// Allocate hchan and buf in one call.</span>
        <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">hchan</span><span class="p">)(</span><span class="n">mallocgc</span><span class="p">(</span><span class="n">hchanSize</span><span class="o">+</span><span class="n">mem</span><span class="p">,</span> <span class="no">nil</span><span class="p">,</span> <span class="no">true</span><span class="p">))</span>
        <span class="n">c</span><span class="o">.</span><span class="n">buf</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="n">unsafe</span><span class="o">.</span><span class="n">Pointer</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="n">hchanSize</span><span class="p">)</span>
    <span class="k">default</span><span class="o">:</span>
        <span class="c">// Elements contain pointers.</span>
        <span class="n">c</span> <span class="o">=</span> <span class="nb">new</span><span class="p">(</span><span class="n">hchan</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">buf</span> <span class="o">=</span> <span class="n">mallocgc</span><span class="p">(</span><span class="n">mem</span><span class="p">,</span> <span class="n">elem</span><span class="p">,</span> <span class="no">true</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">c</span><span class="o">.</span><span class="n">elemsize</span> <span class="o">=</span> <span class="kt">uint16</span><span class="p">(</span><span class="n">elem</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">elemtype</span> <span class="o">=</span> <span class="n">elem</span>
    <span class="n">c</span><span class="o">.</span><span class="n">dataqsiz</span> <span class="o">=</span> <span class="kt">uint</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>

    <span class="o">...</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>
<blockquote>
  <p>makechan 的詳細實作可參考 <a href="https://github.com/golang/go/blob/master/src/runtime/chan.go#L71">src/runtime/chan.go</a></p>
</blockquote>

<p>make 一個 channel 相對的簡單<br>
從上述可以看得出來，首先先計算出總共需要多少的記憶體，接下來 switch case 就是分別 malloc<br>
值得注意的是，如果是 unbuffered channel, 他的 buf pointer 會指向自己(跟 GC 有關，待補)<br>
它並不會使用 buf pointer 存取資料，取而代之的是會將 data 存於 sudog 上面</p>

<blockquote>
  <p>sudog, 為 g 的封裝，有關 g 的部份，可以參考 <a href="../../random/golang-goroutine">Goroutine 與 Golang Runtime Scheduler | Shawn Hsu</a></p>
</blockquote>

<blockquote>
  <p>element size is zero 的情況會是，如果 array 或者是 structure 並未擁有任何 field 或 element 的情況下，其大小為 0<br>
比如說 myStruct{} 的大小會是 0</p>
</blockquote>

<h3 id="send-on-channel">Send on Channel</h3>
<p>對於 buffered channel 來說，寫資料進 channel 很直覺<br>
就是將資料寫進去 buf 裡面就可以了</p>

<p>對於 unbuffered channel 來說，由於 hchan 上面沒有任何儲存單個資料的位置<br>
實際上他是放到 sudog 上面的 elem 上面</p>

<p>如果有人提前在 receive queue 裡面等待的話，把資料寫進去 buffer 裡面再讀出來就會顯得很多餘<br>
因此，可以先做檢查，就像這樣(<a href="https://github.com/golang/go/blob/master/src/runtime/chan.go#L209">go/src/runtime/chan.go#209</a>)<br>
其中 ep 為指向資料的指標</p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td>
<td class="rouge-code"><pre><span class="k">if</span> <span class="n">sg</span> <span class="o">:=</span> <span class="n">c</span><span class="o">.</span><span class="n">recvq</span><span class="o">.</span><span class="n">dequeue</span><span class="p">();</span> <span class="n">sg</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="c">// Found a waiting receiver. We pass the value we want to send</span>
    <span class="c">// directly to the receiver, bypassing the channel buffer (if any).</span>
    <span class="n">send</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">sg</span><span class="p">,</span> <span class="n">ep</span><span class="p">,</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span> <span class="n">unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="o">.</span><span class="n">lock</span><span class="p">)</span> <span class="p">},</span> <span class="m">3</span><span class="p">)</span>
    <span class="k">return</span> <span class="no">true</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>寫資料進 buffer 就相對單純(<a href="https://github.com/golang/go/blob/master/src/runtime/chan.go#L216">go/src/runtime/chan.go#216</a>)</p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td>
<td class="rouge-code"><pre><span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">qcount</span> <span class="o">&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">dataqsiz</span> <span class="p">{</span>
    <span class="c">// Space is available in the channel buffer. Enqueue the element to send.</span>
    <span class="n">qp</span> <span class="o">:=</span> <span class="n">chanbuf</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">sendx</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">raceenabled</span> <span class="p">{</span>
        <span class="n">racenotify</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">sendx</span><span class="p">,</span> <span class="no">nil</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">typedmemmove</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">elemtype</span><span class="p">,</span> <span class="n">qp</span><span class="p">,</span> <span class="n">ep</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">sendx</span><span class="o">++</span>
    <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">sendx</span> <span class="o">==</span> <span class="n">c</span><span class="o">.</span><span class="n">dataqsiz</span> <span class="p">{</span>
        <span class="n">c</span><span class="o">.</span><span class="n">sendx</span> <span class="o">=</span> <span class="m">0</span>
    <span class="p">}</span>
    <span class="n">c</span><span class="o">.</span><span class="n">qcount</span><span class="o">++</span>
    <span class="n">unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="o">.</span><span class="n">lock</span><span class="p">)</span>
    <span class="k">return</span> <span class="no">true</span>
<span class="p">}</span>

<span class="k">if</span> <span class="o">!</span><span class="n">block</span> <span class="p">{</span>
    <span class="n">unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="o">.</span><span class="n">lock</span><span class="p">)</span>
    <span class="k">return</span> <span class="no">false</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>
<p>當還有空間的時候，先將特定位置 malloc 出來(qp)<br>
將資料移動到目標位置上(<code class="language-plaintext highlighter-rouge">typedmemmove</code>)<br>
最後再做 counter 更新，釋放 mutex lock(保護 channel object)</p>

<p>如果 buffer 滿了呢？ 它會失敗<br>
<a href="#bounded-capacity-buffer">Bounded Buffer</a> 在 golang 的 context 的意思是 non-blocking<br>
看看上面的 code<br>
non-blocking <img class="emoji" title=":arrow_right:" alt=":arrow_right:" src="https://github.githubassets.com/images/icons/emoji/unicode/27a1.png" height="20" width="20"> block 會是 false<br>
又因為 buffer 滿了，所以它會跑到最下面的那一個 if<br>
也因此它會 <code class="language-plaintext highlighter-rouge">return false</code></p>

<hr>

<p>blocking 的情況下，就是將自己塞進去 sender wait queue(<code class="language-plaintext highlighter-rouge">sendq</code>)<br>
然後 gopark 等待被叫醒</p>

<blockquote>
  <p>gopark 想的簡單點就是被暫停，swap out 的概念</p>
</blockquote>

<p><img src="https://miro.medium.com/v2/resize:fit:640/1*cVt3pF8FcBtF3q1oVc3fHg.gif" alt=""></p>
<blockquote>
  <p>ref: <a href="https://levelup.gitconnected.com/how-does-golang-channel-works-6d66acd54753">How Does Golang Channel Works</a></p>
</blockquote>

<hr>

<p>那如果往 closed channel 塞資料會發生什麼事情？<br>
它會 <strong>直接 panic</strong>(可參考 <a href="https://github.com/golang/go/blob/master/src/runtime/chan.go#L204">go/src/runtime/chan.go#204</a>)</p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td>
<td class="rouge-code"><pre><span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">closed</span> <span class="o">!=</span> <span class="m">0</span> <span class="p">{</span>
    <span class="n">unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="o">.</span><span class="n">lock</span><span class="p">)</span>
    <span class="nb">panic</span><span class="p">(</span><span class="n">plainError</span><span class="p">(</span><span class="s">"send on closed channel"</span><span class="p">))</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<h3 id="receive-on-channel">Receive on Channel</h3>
<p>基本上 receive 的過程跟 send 差不多<br>
也是先檢查 sendq 有沒有人存在，如果有，就直接從他的 sudog 拿資料並返回
<a href="https://github.com/golang/go/blob/master/src/runtime/chan.go#L513">go/src/runtime/chan.go#513</a></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td>
<td class="rouge-code"><pre><span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">closed</span> <span class="o">!=</span> <span class="m">0</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">qcount</span> <span class="o">==</span> <span class="m">0</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">raceenabled</span> <span class="p">{</span>
            <span class="n">raceacquire</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">raceaddr</span><span class="p">())</span>
        <span class="p">}</span>
        <span class="n">unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="o">.</span><span class="n">lock</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ep</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
            <span class="n">typedmemclr</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">elemtype</span><span class="p">,</span> <span class="n">ep</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="no">true</span><span class="p">,</span> <span class="no">false</span>
    <span class="p">}</span>
    <span class="c">// The channel has been closed, but the channel's buffer have data.</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c">// Just found waiting sender with not closed.</span>
    <span class="k">if</span> <span class="n">sg</span> <span class="o">:=</span> <span class="n">c</span><span class="o">.</span><span class="n">sendq</span><span class="o">.</span><span class="n">dequeue</span><span class="p">();</span> <span class="n">sg</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
        <span class="c">// Found a waiting sender. If buffer is size 0, receive value</span>
        <span class="c">// directly from sender. Otherwise, receive from head of queue</span>
        <span class="c">// and add sender's value to the tail of the queue (both map to</span>
        <span class="c">// the same buffer slot because the queue is full).</span>
        <span class="n">recv</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">sg</span><span class="p">,</span> <span class="n">ep</span><span class="p">,</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span> <span class="n">unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="o">.</span><span class="n">lock</span><span class="p">)</span> <span class="p">},</span> <span class="m">3</span><span class="p">)</span>
        <span class="k">return</span> <span class="no">true</span><span class="p">,</span> <span class="no">true</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>不然就是讀取 ring buffer(<a href="https://github.com/golang/go/blob/master/src/runtime/chan.go#L537">go/src/runtime/chan.go#537</a>)</p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td>
<td class="rouge-code"><pre><span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">qcount</span> <span class="o">&gt;</span> <span class="m">0</span> <span class="p">{</span>
    <span class="c">// Receive directly from queue</span>
    <span class="n">qp</span> <span class="o">:=</span> <span class="n">chanbuf</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">recvx</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">raceenabled</span> <span class="p">{</span>
        <span class="n">racenotify</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">recvx</span><span class="p">,</span> <span class="no">nil</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="n">ep</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
        <span class="n">typedmemmove</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">elemtype</span><span class="p">,</span> <span class="n">ep</span><span class="p">,</span> <span class="n">qp</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">typedmemclr</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">elemtype</span><span class="p">,</span> <span class="n">qp</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">recvx</span><span class="o">++</span>
    <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">recvx</span> <span class="o">==</span> <span class="n">c</span><span class="o">.</span><span class="n">dataqsiz</span> <span class="p">{</span>
        <span class="n">c</span><span class="o">.</span><span class="n">recvx</span> <span class="o">=</span> <span class="m">0</span>
    <span class="p">}</span>
    <span class="n">c</span><span class="o">.</span><span class="n">qcount</span><span class="o">--</span>
    <span class="n">unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="o">.</span><span class="n">lock</span><span class="p">)</span>
    <span class="k">return</span> <span class="no">true</span><span class="p">,</span> <span class="no">true</span>
<span class="p">}</span>

<span class="k">if</span> <span class="o">!</span><span class="n">block</span> <span class="p">{</span>
    <span class="n">unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="o">.</span><span class="n">lock</span><span class="p">)</span>
    <span class="k">return</span> <span class="no">false</span><span class="p">,</span> <span class="no">false</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>blocking 的情況下，將自己塞入 receiver wait queue(<code class="language-plaintext highlighter-rouge">recvq</code>)</p>

<p><img src="https://miro.medium.com/v2/resize:fit:720/1*pisoQBZZpXjFxwXuSfIWuA.gif" alt=""></p>
<blockquote>
  <p>ref: <a href="https://levelup.gitconnected.com/how-does-golang-channel-works-6d66acd54753">How Does Golang Channel Works</a></p>
</blockquote>

<hr>

<p>值得注意的是，讀取 closed channel <strong>並不會造成 panic</strong><br>
根據 <a href="https://github.com/golang/go/blob/master/src/runtime/chan.go#L513">go/src/runtime/chan.go#513</a></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
<td class="rouge-code"><pre><span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">closed</span> <span class="o">!=</span> <span class="m">0</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">qcount</span> <span class="o">==</span> <span class="m">0</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">raceenabled</span> <span class="p">{</span>
            <span class="n">raceacquire</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">raceaddr</span><span class="p">())</span>
        <span class="p">}</span>
        <span class="n">unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="o">.</span><span class="n">lock</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ep</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
            <span class="n">typedmemclr</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">elemtype</span><span class="p">,</span> <span class="n">ep</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="no">true</span><span class="p">,</span> <span class="no">false</span>
    <span class="p">}</span>
    <span class="c">// The channel has been closed, but the channel's buffer have data.</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>
<p>我們可以發現，當 channel 被 closed 的時候，他的返回值會被清空(<code class="language-plaintext highlighter-rouge">typedmemclr</code>)<br>
所以你讀到的數值就是空值(它會根據型態自動轉型, e.g. <code class="language-plaintext highlighter-rouge">false</code>, <code class="language-plaintext highlighter-rouge">0</code>)</p>

<h2 id="explicit-close-channel">Explicit Close Channel</h2>
<p>當你不需要 channel 的時候，可以使用 <code class="language-plaintext highlighter-rouge">close(channel)</code> 來關閉 channel<br>
不過通常來說你不需要手動關閉 channel</p>

<p>根據 <a href="https://go.dev/tour/concurrency/4">A Tour of Go - Range and Close</a> 所述</p>

<blockquote>
  <p>Channels aren’t like files; <br>
you don’t usually need to close them. <br>
Closing is only necessary when the receiver must be told there are no more values coming, <br>
such as to terminate a range loop.</p>
</blockquote>

<p>所以你不用 close 它，GC 會處理的</p>

<h2 id="share-memory-by-communicating">Share Memory by Communicating</h2>
<p><code class="language-plaintext highlighter-rouge">Do not communicate by sharing memory; instead, share memory by communicating.</code></p>

<p>一般來說，當你要在不同執行緒共享資料(e.g. <a href="#shared-memory">Shared Memory</a> 或者是 <a href="#message-passing">Message Passing</a>)，會順便加一個 mutex lock 的互斥鎖，確保在多執行緒的狀況下，不會出現 data race 等等不可預期的情況<br>
golang 的 channel 提供了一個不同的思路</p>

<p>channel 在設計上，就根本的解決了 data race 的問題<br>
在單位時間內，只會有一個 goroutine 有辦法存取資料<br>
多個 goroutine 競爭要拿資料的時候，他們都會在 wait queue 等待<br>
一次只會取一個 goroutine 出來取資料</p>

<p>你說 channel 還不是要用 mutex lock 保護<br>
這樣做有什麼好處嗎<br>
我個人是覺的透過 channel 的機制，可以讓你撰寫出容易理解並維護的程式<br>
可以參考 <a href="#producer-consumer-example">Producer Consumer Example</a></p>

<blockquote>
  <p>注意到雖然 channel 可以避免 explicit locking<br>
但未必 locking 是一個不好的選項，在實作時，應當就狀況考慮相關 trade-off</p>
</blockquote>

<h1 id="select-on-channel">Select on Channel</h1>
<p>select 用於在多個 channel 之間，選擇其中一個並 process<br>
他的工作流程如下</p>
<ol>
  <li>對於所有 channel 進行洗牌(確保公平)</li>
  <li>針對洗牌後的 channel 一個一個檢查看是否已就緒(ready)
    <ul>
      <li>檢查每個 channel 的 <code class="language-plaintext highlighter-rouge">sendq</code> 以及 <code class="language-plaintext highlighter-rouge">recvq</code> 就知道 channel ready or not 了</li>
    </ul>
  </li>
  <li>Block on all channel
    <ul>
      <li>如果 select 的 channel 們都被 block 住，我要怎麼知道哪個 channel 已經好了？<br>
 借用第二點的知識，我們知道當 sudog 出現在 wait queue 當中就代表該 channel 準備好了<br>
 所以這裡的檢查方式超暴力的，new 一個 sudog 把它塞進去該 channel 的 wait queue 裡面<br>
 如果我下一次進去該 channel，看到新的 sudog 還在裡面就代表它還在 block, 反之則 ready<br>
 <br>
 可是這樣不就沒用了嗎？ 因為我檢查也是看 wait queue 阿？<br>
 如果是 select <code class="language-plaintext highlighter-rouge">send</code>, 那就把 sudog 加到 <code class="language-plaintext highlighter-rouge">recvq</code>, 依此類推<br>
 所以它可以正確的辨別 channel 的狀態這點是不用擔心的</li>
    </ul>
  </li>
  <li>Unblock on channel
    <ul>
      <li>前面為了要辨別哪個 channel 已經準備好了，我們將 sudog 加到 <strong>每一個 channel wait queue</strong> 上面，這裡，要 undo<br>
 走訪每個 channel，把 sudog dequeue 出來的同時，紀錄下被選中的幸運 channel<br>
 等到都處理完了之後，就可以針對該幸運 channel 做 send/receive <br>
 並且回傳 select 選中的 channel index</li>
    </ul>
  </li>
</ol>

<h2 id="nil-value-from-channel">Nil Value from Channel</h2>
<p>從 channel 拉資料的時候你需要同步檢查 channel 是否已經被關閉<br>
也就是</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td>
<td class="rouge-code"><pre><span class="n">value</span><span class="p">,</span> <span class="n">ok</span> <span class="o">:=</span> <span class="o">&lt;-</span> <span class="n">a</span><span class="o">.</span><span class="n">ch</span>

<span class="k">if</span> <span class="o">!</span><span class="n">ok</span> <span class="p">{</span>
    <span class="nb">panic</span><span class="p">(</span><span class="s">"channel is closed"</span><span class="p">)</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>避免你直接存取 value 的時候，因為他是 nil 而導致 panic</p>

<h1 id="producer-consumer-example">Producer Consumer Example</h1>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
</pre></td>
<td class="rouge-code"><pre><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
    <span class="s">"fmt"</span>
    <span class="s">"math/rand"</span>
    <span class="s">"time"</span>
<span class="p">)</span>

<span class="k">const</span> <span class="p">(</span>
    <span class="n">size</span> <span class="o">=</span> <span class="m">100</span>
<span class="p">)</span>

<span class="k">type</span> <span class="n">Job</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">Target</span> <span class="kt">int</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">producer</span><span class="p">(</span><span class="n">jobChannel</span> <span class="k">chan</span> <span class="n">Job</span><span class="p">,</span> <span class="n">statusChannel</span> <span class="k">chan</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="n">status</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">statusChannel</span> <span class="p">{</span>
        <span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="m">1</span> <span class="o">*</span> <span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">status</span> <span class="p">{</span>
            <span class="n">jobChannel</span> <span class="o">&lt;-</span> <span class="n">Job</span><span class="p">{</span><span class="n">Target</span><span class="o">:</span> <span class="n">rand</span><span class="o">.</span><span class="n">Intn</span><span class="p">(</span><span class="m">100</span><span class="p">)}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">consumer</span><span class="p">(</span><span class="n">id</span> <span class="kt">int</span><span class="p">,</span> <span class="n">jobChannel</span> <span class="k">chan</span> <span class="n">Job</span><span class="p">,</span> <span class="n">statusChannel</span> <span class="k">chan</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="n">job</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">jobChannel</span> <span class="p">{</span>
        <span class="n">success</span> <span class="o">:=</span> <span class="n">rand</span><span class="o">.</span><span class="n">Intn</span><span class="p">(</span><span class="m">100</span><span class="p">)</span> <span class="o">%</span> <span class="m">2</span> <span class="o">==</span> <span class="m">1</span>

        <span class="k">if</span> <span class="n">success</span> <span class="p">{</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"%3d finished the job</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span>
            <span class="n">statusChannel</span> <span class="o">&lt;-</span> <span class="no">true</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">%3d failed the job</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span>
            <span class="n">jobChannel</span> <span class="o">&lt;-</span> <span class="n">job</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">jobChannel</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="n">Job</span><span class="p">)</span>
    <span class="n">statusChannel</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="kt">bool</span><span class="p">)</span>
    <span class="k">defer</span> <span class="nb">close</span><span class="p">(</span><span class="n">jobChannel</span><span class="p">)</span>
    <span class="k">defer</span> <span class="nb">close</span><span class="p">(</span><span class="n">statusChannel</span><span class="p">)</span>

    <span class="k">go</span> <span class="n">producer</span><span class="p">(</span><span class="n">jobChannel</span><span class="p">,</span> <span class="n">statusChannel</span><span class="p">)</span>
    <span class="n">statusChannel</span> <span class="o">&lt;-</span> <span class="no">true</span>

    <span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="k">go</span> <span class="n">consumer</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">jobChannel</span><span class="p">,</span> <span class="n">statusChannel</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">select</span><span class="p">{}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>這是一個簡單版本的 producer consumer 的 goroutine 與 channel 的實作<br>
其中，producer 負責生成一個 task 而 consumer 要嘗試解決這個 task<br>
為了簡化程式，在 consumer 當中，透過簡單的擲骰子用以判斷 task 成功被解決與否</p>

<p>在這個例子裡面，是使用 unbuffered channel <img class="emoji" title=":arrow_right:" alt=":arrow_right:" src="https://github.githubassets.com/images/icons/emoji/unicode/27a1.png" height="20" width="20"> 所以整隻程式會是 <a href="#blocking-send">Blocking Send</a> 與 <a href="#blocking-receive">Blocking Receive</a><br>
另外不一樣的是，當某個 goroutine 失敗的時候，它必須要將原本的 task 讓出來給別人嘗試解決，因此需要額外的 statusChannel 紀錄說目前問題被解決了沒<br>
<code class="language-plaintext highlighter-rouge">statusChannel &lt;- true</code> 必須寫在 <code class="language-plaintext highlighter-rouge">go producer</code> 後面的原因是因為，必須先要有人接收資料，才能開始送資料(不然會 <code class="language-plaintext highlighter-rouge">all goroutines are deadlock</code>)<br>
由於本例是以 unbuffered channel 的方式撰寫<br>
因此，當 consumer 的數量小於等於 1 的時候，將會觸發 deadlock，因為當 failed 的時候，重新 enqueue 寫進去 channel 的資料將沒有人可以讀取(all goroutines are asleep)</p>

<p>main 函數裡面的 <code class="language-plaintext highlighter-rouge">select{}</code> 是用以阻塞 main goroutine<br>
因為所有主要執行程式都是以 goroutine 的方式下去執行，main 函數將會直接 return(它不會等待其他 goroutine)</p>

<p>注意到取出 channel 的資料有兩種寫法<br>
第一個是範例中，for-range 的寫法是 unblocking 的<br>
另一種是你比較熟悉的</p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td>
<td class="rouge-code"><pre><span class="k">for</span> <span class="p">{</span>
    <span class="k">select</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">job</span><span class="p">,</span> <span class="n">ok</span> <span class="o">:=</span> <span class="o">&lt;-</span> <span class="n">jobChannel</span><span class="o">:</span>
        <span class="c">// do something</span>

    <span class="k">default</span><span class="o">:</span>
        <span class="c">// nop</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>
<p>這種寫法適用於你有多個 channel 需要接收資料<br>
需要注意的是，<code class="language-plaintext highlighter-rouge">加了 default 才是 non-blocking</code></p>

<p>跑起來的結果如下</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td>
<td class="rouge-code"><pre>         19 failed the job
         31 failed the job
         26 failed the job
         27 failed the job
 21 finished the job

         28 failed the job
         22 failed the job
 29 finished the job

         23 failed the job
 30 finished the job

         24 failed the job
 34 finished the job

         32 failed the job
         25 failed the job
 33 finished the job

         36 failed the job
         35 failed the job
 37 finished the job

          2 failed the job
         45 failed the job
 38 finished the job
</pre></td>
</tr></tbody></table></code></pre></div></div>

<h1 id="references">References</h1>
<ul>
  <li><a href="https://go.dev/blog/codelab-share">Share Memory By Communicating</a></li>
  <li><a href="https://stackoverflow.com/questions/48953236/how-to-implement-non-blocking-write-to-an-unbuffered-channel">How to implement non-blocking write to an unbuffered channel?</a></li>
  <li><a href="https://beingintelligent.com/difference-between-shared-memory-and-message-passing-process-communication.html">Difference Between Shared Memory and Message Passing Process Communication</a></li>
  <li><a href="https://www.tutorialspoint.com/what-is-message-passing-technique-in-os">What is message passing technique in OS?</a></li>
  <li><a href="https://stackoverflow.com/questions/19621149/how-are-go-channels-implemented">How are Go channels implemented?</a></li>
  <li><a href="https://levelup.gitconnected.com/how-does-golang-channel-works-6d66acd54753">How Does Golang Channel Works</a></li>
  <li><a href="https://docs.google.com/document/d/1yIAYmbvL3JxOKOjuCyon7JhW4cSv1wy5hC0ApeGMV9s/pub">Go channels on steroids</a></li>
  <li><a href="https://stackoverflow.com/questions/2553637/what-are-the-uses-of-circular-buffer">What are the uses of circular buffer?</a></li>
  <li><a href="https://stackoverflow.com/questions/57085905/which-types-size-is-zero-in-slice-of-golang">which type’s size is zero in slice of golang?</a></li>
  <li><a href="https://zh.wikipedia.org/zh-tw/%E7%92%B0%E5%BD%A2%E7%B7%A9%E8%A1%9D%E5%8D%80">環形緩衝區</a></li>
  <li><a href="https://zhuanlan.zhihu.com/p/534098236">ring buffer，一篇文章讲透它？</a></li>
  <li><a href="https://stackoverflow.com/questions/50588299/empty-a-ring-buffer-when-full">Empty a ring buffer when full</a></li>
  <li><a href="https://easonwang.gitbook.io/golang/ji-ben-yu-fa/channel/for-select-yu-for-range">for select 與 for range</a></li>
  <li><a href="https://www.readfog.com/a/1651951565605539840">深入理解 Golang Channel 結構</a></li>
  <li><a href="https://tiancaiamao.gitbooks.io/go-internals/content/zh/07.1.html">7.1 channel</a></li>
  <li><a href="https://blog.csdn.net/qq_25870633/article/details/83388952">【我的架构师之路】- golang源码分析之channel的底层实现</a></li>
  <li><a href="https://hackmd.io/@RinHizakura/ryx18x4-t">2021q3 Homework3 (lfring)</a></li>
  <li><a href="https://stackoverflow.com/questions/8593645/is-it-ok-to-leave-a-channel-open">Is it OK to leave a channel open?</a></li>
</ul>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#blocking-receive" class="page__taxonomy-item p-category" rel="tag">blocking receive</a><span class="sep">, </span>
    
      <a href="/tags/#blocking-send" class="page__taxonomy-item p-category" rel="tag">blocking send</a><span class="sep">, </span>
    
      <a href="/tags/#channel" class="page__taxonomy-item p-category" rel="tag">channel</a><span class="sep">, </span>
    
      <a href="/tags/#coroutine" class="page__taxonomy-item p-category" rel="tag">coroutine</a><span class="sep">, </span>
    
      <a href="/tags/#counter-approach" class="page__taxonomy-item p-category" rel="tag">counter approach</a><span class="sep">, </span>
    
      <a href="/tags/#golang" class="page__taxonomy-item p-category" rel="tag">golang</a><span class="sep">, </span>
    
      <a href="/tags/#goroutine" class="page__taxonomy-item p-category" rel="tag">goroutine</a><span class="sep">, </span>
    
      <a href="/tags/#inter-process-communication" class="page__taxonomy-item p-category" rel="tag">inter-process communication</a><span class="sep">, </span>
    
      <a href="/tags/#last-operation-approach" class="page__taxonomy-item p-category" rel="tag">last operation approach</a><span class="sep">, </span>
    
      <a href="/tags/#lock" class="page__taxonomy-item p-category" rel="tag">lock</a><span class="sep">, </span>
    
      <a href="/tags/#makechan" class="page__taxonomy-item p-category" rel="tag">makechan</a><span class="sep">, </span>
    
      <a href="/tags/#message-passing" class="page__taxonomy-item p-category" rel="tag">message passing</a><span class="sep">, </span>
    
      <a href="/tags/#mirror-approach" class="page__taxonomy-item p-category" rel="tag">mirror approach</a><span class="sep">, </span>
    
      <a href="/tags/#mutex" class="page__taxonomy-item p-category" rel="tag">mutex</a><span class="sep">, </span>
    
      <a href="/tags/#non-blocking-receive" class="page__taxonomy-item p-category" rel="tag">non-blocking receive</a><span class="sep">, </span>
    
      <a href="/tags/#non-blocking-send" class="page__taxonomy-item p-category" rel="tag">non-blocking send</a><span class="sep">, </span>
    
      <a href="/tags/#process" class="page__taxonomy-item p-category" rel="tag">process</a><span class="sep">, </span>
    
      <a href="/tags/#producer-consumer" class="page__taxonomy-item p-category" rel="tag">producer consumer</a><span class="sep">, </span>
    
      <a href="/tags/#receive" class="page__taxonomy-item p-category" rel="tag">receive</a><span class="sep">, </span>
    
      <a href="/tags/#ring-buffer" class="page__taxonomy-item p-category" rel="tag">ring buffer</a><span class="sep">, </span>
    
      <a href="/tags/#select" class="page__taxonomy-item p-category" rel="tag">select</a><span class="sep">, </span>
    
      <a href="/tags/#send" class="page__taxonomy-item p-category" rel="tag">send</a><span class="sep">, </span>
    
      <a href="/tags/#shared-memory" class="page__taxonomy-item p-category" rel="tag">shared memory</a><span class="sep">, </span>
    
      <a href="/tags/#store-only-size-1-element" class="page__taxonomy-item p-category" rel="tag">store only size - 1 element</a><span class="sep">, </span>
    
      <a href="/tags/#sudog" class="page__taxonomy-item p-category" rel="tag">sudog</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#random" class="page__taxonomy-item p-category" rel="tag">random</a>
    
    </span>
  </p>


      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=Goroutine+%E8%88%87+Channel+%E7%9A%84%E5%85%B1%E8%88%9E%20https%3A%2F%2Fambersuncreates.com%2Frandom%2Fgolang-channel%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fambersuncreates.com%2Frandom%2Fgolang-channel%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fambersuncreates.com%2Frandom%2Fgolang-channel%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/website/website-cors/" class="pagination--pager" title="網頁程式設計三兩事 - 萬惡的 Same Origin 與 CORS
">Previous</a>
    
    
      <a href="/angular/angular-hooks/" class="pagination--pager" title="邁向 Angular 前端工程師之路 - Lifecycle Hooks
">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
      <h4 class="page__comments-title">Leave a comment</h4>
      <section id="disqus_thread"></section>
    
</div>

    
  </article>

  
  
    <div class="page__related">
      <h2 class="page__related-title">You may also enjoy</h2>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/database/database-filter/" rel="permalink">資料庫 - 機率型資料結構 Bloom Filter 在 Cache 中的應用
</a>
      
    </h2>
    


  <p class="page__meta">
    

    

    
      
      

      

         

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>

         

      <span class="page__meta-readtime">
        <i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i>Posted on:
        <time class="dt-published" datetime="2026-01-19">2026-01-19</time>
      </span>

      
           
        
        <span class="page__meta-readtime">
          <i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i>Updated on:
          <time class="dt-published" datetime="2025-12-17">
            2025-12-17
          </time>
        </span>

           

        <span>
          <i class="fas fa-eye" aria-hidden="true"></i>
          Views: <span id="view-field-/database/database-filter/"> Loading...</span>
        </span>
      
    
  </p>


<script>
  fetch(`https://api.ambersuncreates.com/views?url=/database/database-filter/`)
    .then(async (response) => {
      if (response.ok) {
        data = await response.json();

        let text = "-";
        if (data.views > 100) {
          text = Intl.NumberFormat('en', { notation: 'compact' }).format(data.views);
        }
        document.getElementById("view-field-/database/database-filter/").innerHTML = text;
      }
    })
</script>

    <p class="archive__item-excerpt" itemprop="description">Cache Issues
就像我們在 資料庫 - Cache Strategies 與常見的 Solutions | Shawn Hsu 當中提到的
如果碰到惡意攻擊，查詢不在 cache 也不在 database 裡面的資料，那麼所有的請求都會直接到 database，然後又會直接被打爆
所以其實在這種狀況底下...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/random/golang-gc/" rel="permalink">多開 Goroutine 的效能瓶頸以及 Garbage Collection 對其的影響
</a>
      
    </h2>
    


  <p class="page__meta">
    

    

    
      
      

      

         

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          9 minute read
        
      </span>

         

      <span class="page__meta-readtime">
        <i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i>Posted on:
        <time class="dt-published" datetime="2026-01-15">2026-01-15</time>
      </span>

      
           
        
        <span class="page__meta-readtime">
          <i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i>Updated on:
          <time class="dt-published" datetime="2025-12-17">
            2025-12-17
          </time>
        </span>

           

        <span>
          <i class="fas fa-eye" aria-hidden="true"></i>
          Views: <span id="view-field-/random/golang-gc/"> Loading...</span>
        </span>
      
    
  </p>


<script>
  fetch(`https://api.ambersuncreates.com/views?url=/random/golang-gc/`)
    .then(async (response) => {
      if (response.ok) {
        data = await response.json();

        let text = "-";
        if (data.views > 100) {
          text = Intl.NumberFormat('en', { notation: 'compact' }).format(data.views);
        }
        document.getElementById("view-field-/random/golang-gc/").innerHTML = text;
      }
    })
</script>

    <p class="archive__item-excerpt" itemprop="description">Preface
Goroutine 作為 Golang 的一大特色
其輕量且快速的特性，使得其的開銷相比 process 以及 thread 要來的低上許多
因此人們往往會將 Goroutine 用在非同步的操作上，比如說 I/O 或者是 CPU-bound 的操作
用以達到併發的效果

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/kubernetes/kubernetes-workloads/" rel="permalink">Kubernetes 從零開始 - Pod 高級抽象 Workload Resources
</a>
      
    </h2>
    


  <p class="page__meta">
    

    

    
      
      

      

         

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          6 minute read
        
      </span>

         

      <span class="page__meta-readtime">
        <i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i>Posted on:
        <time class="dt-published" datetime="2025-11-23">2025-11-23</time>
      </span>

      
           
        
        <span class="page__meta-readtime">
          <i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i>Updated on:
          <time class="dt-published" datetime="2025-12-17">
            2025-12-17
          </time>
        </span>

           

        <span>
          <i class="fas fa-eye" aria-hidden="true"></i>
          Views: <span id="view-field-/kubernetes/kubernetes-workloads/"> Loading...</span>
        </span>
      
    
  </p>


<script>
  fetch(`https://api.ambersuncreates.com/views?url=/kubernetes/kubernetes-workloads/`)
    .then(async (response) => {
      if (response.ok) {
        data = await response.json();

        let text = "-";
        if (data.views > 100) {
          text = Intl.NumberFormat('en', { notation: 'compact' }).format(data.views);
        }
        document.getElementById("view-field-/kubernetes/kubernetes-workloads/").innerHTML = text;
      }
    })
</script>

    <p class="archive__item-excerpt" itemprop="description">High Level Abstraction
之前提到 Pod 是 Kubernetes 當中部署的最小單位，因為其設計關係(比如說容易被 reschedule 以及被刪除等等)，是比較不適合直接操作的
因此 Kubernetes 提供了更高層次的抽象，讓我們可以更方便的管理 Pod
本文將會走過一遍這些更高階的...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/kubernetes/kubernetes-volume/" rel="permalink">Kubernetes 從零開始 - 你的 Volume 到底 Mount 到哪裡去了？
</a>
      
    </h2>
    


  <p class="page__meta">
    

    

    
      
      

      

         

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          8 minute read
        
      </span>

         

      <span class="page__meta-readtime">
        <i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i>Posted on:
        <time class="dt-published" datetime="2025-11-13">2025-11-13</time>
      </span>

      
           
        
        <span class="page__meta-readtime">
          <i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i>Updated on:
          <time class="dt-published" datetime="2025-12-17">
            2025-12-17
          </time>
        </span>

           

        <span>
          <i class="fas fa-eye" aria-hidden="true"></i>
          Views: <span id="view-field-/kubernetes/kubernetes-volume/"> Loading...</span>
        </span>
      
    
  </p>


<script>
  fetch(`https://api.ambersuncreates.com/views?url=/kubernetes/kubernetes-volume/`)
    .then(async (response) => {
      if (response.ok) {
        data = await response.json();

        let text = "-";
        if (data.views > 100) {
          text = Intl.NumberFormat('en', { notation: 'compact' }).format(data.views);
        }
        document.getElementById("view-field-/kubernetes/kubernetes-volume/").innerHTML = text;
      }
    })
</script>

    <p class="archive__item-excerpt" itemprop="description">Introduction to Kubernetes Volume
從 Docker 的年代開始，掛載 host 的檔案系統不是什麼新鮮事
而 mount 的方式也很直覺，直接指定 host 的檔案路徑，你就能夠在 container 裡面存取相關的資料
到了 Kubernetes，也是有一樣的概念，但是 mou...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

<script type="text/javascript">
  let viewHeight = window. innerHeight;
  let codeblocks = document.getElementsByClassName("highlight");

  Array.from(codeblocks).forEach(value => {
      if (value.scrollHeight > viewHeight) {
          value.setAttribute("style", "height:100vh;overflow-y:auto;");
      }
  })
</script>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap">
<form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term...">
  </form>
  <div id="results" class="results"></div>
</div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
          <li><a href="https://github.com/ambersun1234" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
      
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">© 2026 Shawn Hsu. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Q9EYCKB89S"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Q9EYCKB89S', { 'anonymize_ip': false});
</script>






    
  <script>
    var disqus_config = function () {
      this.page.url = "https://ambersuncreates.com/random/golang-channel/";  /* Replace PAGE_URL with your page's canonical URL variable */
      this.page.identifier = "/random/golang-channel"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */
    };
    (function() { /* DON'T EDIT BELOW THIS LINE */
      var d = document, s = d.createElement('script');
      s.src = 'https://https-ambersun1234-github-io.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>


  


<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
      inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
    },
    "HTML-CSS": {
      scale: 80
    }
  });
</script>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script> 




  </body>
</html>
